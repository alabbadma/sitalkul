<!doctype html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>منصة ست الكل</title>

    <!-- خط Cairo -->
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap" rel="stylesheet" />
    <style>
      html,body{height:100%;margin:0}
      body,*{font-family:"Cairo",system-ui,-apple-system,Segoe UI,Roboto,Arial,"Noto Sans Arabic",sans-serif}
      #boot{position:fixed;inset:0;display:grid;place-items:center}
      #boot .err{direction:ltr;white-space:pre-wrap;background:#fff3f3;border:1px solid #f5c2c7;border-radius:10px;padding:12px;color:#842029;max-width:90%;max-height:60vh;overflow:auto}
      .stk-footer{position:fixed;left:0;right:0;bottom:0;background:#fff;border-top:1px solid #eee;padding:10px 12px;text-align:center;z-index:9999;font-size:14px;line-height:1.6}
      .stk-hide{display:none !important}
    </style>

    <!-- CSS الأصلي -->
    <link rel="stylesheet" href="./assets/index-f95b4819.css" />
  </head>
  <body>
    <div id="root"></div>
    <div id="boot">جاري التحميل…</div>

    <!-- سكربت التطبيق الأصلي -->
    <script type="module" src="./assets/index-a7c04ef5.js"></script>

    <!-- سكربت فرض الاستبدالات وإضافة الفوتر -->
    <script>
      // عنوان الصفحة والميتا
      document.title = 'منصة ست الكل';
      function setMeta(name, content){
        let el = document.querySelector(`meta[property="${name}"], meta[name="${name}"]`);
        if(!el){
          el = document.createElement('meta');
          (name.startsWith('og:')) ? el.setAttribute('property', name) : el.setAttribute('name', name);
          document.head.appendChild(el);
        }
        el.setAttribute('content', content);
      }
      setMeta('og:title','منصة ست الكل');
      setMeta('twitter:title','منصة ست الكل');
      setMeta('description','منصة ست الكل لإدارة مناشط المدرسة التعليمية واللامنهجية');

      // العبارات المطلوب استبدالها (مع كل الاحتمالات)
      const hardReplacePairs = [
        // العنوان العام
        [/(?:منصة\s*)?النشاط\s*الطلابي/gi, 'منصة ست الكل'],
        // اسم المدرسة
        [/مدرسة\s+.*?\s+المتوسطة/gi, 'مدرسة ست الكل المتوسطة'],
        // التذييل القديم
        [/برمجة\s*و?\s*تصميم/gi, 'جميع الحقوق محفوظة 2025 — أ. محمد بن عبدالعزيز العباد'],
        // أي ظهور لاسم المبرمج القديم
        [/عبد ?الله/gi, 'محمد بن عبدالعزيز العباد'],
        [/Shahid\s*Weeks/gi, 'منصة ست الكل']
      ];

      // استبدال آمن لكل عقدة نصية
      function replaceInNode(node){
        if(node.nodeType === Node.TEXT_NODE){
          let t = node.nodeValue, changed = false;
          for(const [re, rep] of hardReplacePairs){
            const nt = t.replace(re, rep);
            if(nt !== t){ t = nt; changed = true; }
          }
          if(changed) node.nodeValue = t;
        } else if(node.nodeType === Node.ELEMENT_NODE){
          // لو النص موزع على عناصر متعددة داخل عنصر واحد (مثل الفوتر)
          const txt = node.innerText || '';
          if(/برمجة|تصميم|عبد ?الله/.test(txt) && txt.length < 120 && node.tagName !== 'SCRIPT' && node.tagName !== 'STYLE'){
            node.innerText = txt
              .replace(/برمجة\s*و?\s*تصميم/gi, 'جميع الحقوق محفوظة 2025')
              .replace(/عبد ?الله/gi, '');
          }
          node.childNodes.forEach(replaceInNode);
        }
      }

      // إخفاء أي فوتر قديم واضح
      function hideOldFooters(){
        const candidates = Array.from(document.querySelectorAll('footer,[class*="footer"],[id*="footer"]'));
        candidates.forEach(el=>{
          const t = (el.innerText||'').trim();
          if(/برمجة|تصميم|عبد ?الله|حقوق/.test(t)) el.classList.add('stk-hide');
        });
      }

      // إضافة فوترنا الثابت
      function ensureFooter(){
        if(document.getElementById('stk-footer')) return;
        const f = document.createElement('div');
        f.id = 'stk-footer';
        f.className = 'stk-footer';
        f.innerHTML = '<strong>منصة ست الكل</strong><div>منصة تجريبية — جميع الحقوق محفوظة 2025</div>';
        document.body.appendChild(f);
      }

      // تشغيل الاستبدال بشكل متكرر أول ثوانٍ + مراقبة لاحقة
      function sweep(){
        try { replaceInNode(document.body); hideOldFooters(); ensureFooter(); } catch(e){}
      }
      // مسح متكرر أول 10 ثواني (يلتقط تحميل SPA المرحلي)
      let n=0, iv = setInterval(()=>{ sweep(); if(++n>20){ clearInterval(iv); } }, 500);
      // مراقب تغيّرات DOM بعد ذلك
      const mo = new MutationObserver(()=>sweep());
      mo.observe(document.documentElement, { childList:true, subtree:true, characterData:true });

      // إزالة شاشة التحميل بعد ظهور المحتوى
      window.addEventListener('load', ()=>{ document.getElementById('boot')?.remove(); sweep(); });
    </script>

    <noscript>هذه الصفحة تتطلب تفعيل JavaScript.</noscript>
  </body>
</html>
